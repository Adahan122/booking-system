<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç—É—Å –∞—É–¥–∏—Ç–æ—Ä–∏–π</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>–°—Ç–∞—Ç—É—Å –∞—É–¥–∏—Ç–æ—Ä–∏–π</h1>
        
        <div class="header-info">
            <div class="current-time">
                –î–∞—Ç–∞: {{ today }} | –í—Ä–µ–º—è: {{ current_time }}
            </div>
            <a href="/" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—é</a>
        </div>
        
        <div class="stats-overview">
            <div class="stat-card free-stat">
                <h3>–°–≤–æ–±–æ–¥–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏</h3>
                <p class="count">{{ free_classrooms|length }}</p>
            </div>
            <div class="stat-card booked-stat">
                <h3>–ó–∞–Ω—è—Ç—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏</h3>
                <p class="count">{{ booked_classrooms|length }}</p>
            </div>
            <div class="stat-card total-stat">
                <h3>–í—Å–µ–≥–æ –∞—É–¥–∏—Ç–æ—Ä–∏–π</h3>
                <p class="count">{{ free_classrooms|length + booked_classrooms|length }}</p>
            </div>
        </div>
        
        <div class="status-sections">
            <!-- –ó–∞–Ω—è—Ç—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ -->
            <div class="status-section booked-section">
                <h2>üéØ –ó–∞–Ω—è—Ç—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ ({{ booked_classrooms|length }})</h2>
                {% if booked_classrooms %}
                <div class="booked-list">
                    {% for item in booked_classrooms %}
                    <div class="booked-item">
                        <div class="booked-header">
                            <h3>{{ item.classroom.name }}</h3>
                            <span class="occupied-badge">–ó–ê–ù–Ø–¢–ê</span>
                        </div>
                        <div class="booked-details">
                            <p><strong>–ö–µ–º:</strong> {{ item.booking.user_name }}</p>
                            <p><strong>–¶–µ–ª—å:</strong> {{ item.booking.purpose }}</p>
                            <p><strong>–í—Ä–µ–º—è:</strong> {{ item.booking.start_time[:5] }} - {{ item.booking.end_time[:5] }}</p>
                            <p><strong>–û—Å–≤–æ–±–æ–¥–∏—Ç—Å—è –≤:</strong> {{ item.booking.end_time[:5] }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="empty-message">–ù–µ—Ç –∑–∞–Ω—è—Ç—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–π –≤ —Ç–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è</p>
                {% endif %}
            </div>
            
            <!-- –°–≤–æ–±–æ–¥–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ -->
            <div class="status-section free-section">
                <h2>‚úÖ –°–≤–æ–±–æ–¥–Ω—ã–µ –∞—É–¥–∏—Ç–æ—Ä–∏–∏ ({{ free_classrooms|length }})</h2>
                {% if free_classrooms %}
                <div class="free-list">
                    {% for classroom in free_classrooms %}
                    <div class="free-item">
                        <div class="free-header">
                            <h3>{{ classroom.name }}</h3>
                            <span class="free-badge">–°–í–û–ë–û–î–ù–ê</span>
                        </div>
                        <div class="free-details">
                            <p><strong>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:</strong> {{ classroom.capacity }} —á–µ–ª–æ–≤–µ–∫</p>
                            <p><strong>–ö–æ—Ä–ø—É—Å:</strong> {{ classroom.building or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
                            <p><strong>–≠—Ç–∞–∂:</strong> {{ classroom.floor or '–ù–µ —É–∫–∞–∑–∞–Ω' }}</p>
                            <a href="/book/{{ classroom.id }}?date={{ today }}" class="quick-book-btn">
                                –ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ–π—á–∞—Å
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="empty-message">–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–π</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    <script>
        // –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
        setInterval(() => {
            location.reload();
        }, 60000);
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        function updateCurrentTime() {
            const now = new Date();
            const dateString = now.toLocaleDateString('ru-RU');
            const timeString = now.toLocaleTimeString('ru-RU');
            
            const timeElements = document.querySelectorAll('.current-time');
            timeElements.forEach(el => {
                el.innerHTML = `–î–∞—Ç–∞: ${dateString} | –í—Ä–µ–º—è: ${timeString}`;
            });
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É
        setInterval(updateCurrentTime, 1000);
        updateCurrentTime();
    </script>
</body>
</html>